<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Whack-A-Square - First Web Project</title>
  <script>
    let startButton;
    let scoreField;
    let timeField;
    let accField;
    let rateField;
    let target;
    let playing = false;
    let score = 0;
    let time = 30;
    let accVal = 0;
    let hitCount = 0;
    let rateVal = 0;
    let rateMinVal = 0;
    let accuracy = [];
    let rates = [];
    let wasHit = false;
    document.addEventListener('DOMContentLoaded', () => {
      startButton = document.getElementById('start');
      scoreField = document.getElementById('score');
      timeField = document.getElementById('time');
      rateField = document.getElementById('rate');
      accField = document.getElementById('accuracy');
      target = document.getElementById('target');
    });
    function random(cap) {
      return Math.floor(Math.random() * (cap + 1));
    }
    function sleep(ms) {
      return new Promise(r => setTimeout(r, ms));
    }
    async function start() {
      startButton.hidden = true;
      scoreField.hidden = false;
      timeField.hidden = false;
      accField.hidden = false;
      rateField.hidden = false;
      score = 0;
      time = 30;
      hitCount = 0;
      accuracy = [];
      rates = [];
      scoreField.innerHTML = 'Score: 0';
      timeField.innerHTML = 'Time left: 30 seconds';
      accField.innerHTML = 'Accuracy: --%';
      rateField.innerHTML = 'Rate: -- hits per minute (-- per second)';
      playing = true;
      for (var i = 0; i < 30; i++) {
        await sleep(1000);
        time--;
        rates.push(hitCount);
        rateVal = 0;
        rateMinVal = 0;
        for (var j = 0; j < rates.length; j++) {
          rateVal += rates[j];
        }
        rateVal /= rates.length;
        rateVal = Math.round(rateVal * 1000) / 1000;
        rateMinVal = rateVal * 60;
        rateMinVal = Math.round(rateMinVal * 1000) / 1000;
        // This is like the other use (below), but it's limited to three decimals instead of two.
        timeField.innerHTML = 'Time left: ' + time + ' seconds';
        rateField.innerHTML = 'Rate: ' + rateMinVal + ' hits per minute (' + rateVal + ' per second)';
        hitCount = 0;
      }
      alert('Your time is up. Click OK to see your results.');
      playing = false;
      startButton.innerHTML = 'Try again';
      startButton.hidden = false;
    }
    function miss() {
      if (!playing) {return;}
      if (wasHit) {
        wasHit = false;
        return;
      }
      accuracy.push(0);
      accVal = 0;
      for (var i = 0; i < accuracy.length; i++) {
        accVal += accuracy[i];
      }
      accVal /= accuracy.length;
      accVal = Math.round(accVal * 100) / 100;
      accField.innerHTML = 'Accuracy: ' + accVal + '%';
      wasHit = false;
    }
    function hit() {
      if (!playing) {return;}
      wasHit = true;
      score++;
      hitCount++;
      scoreField.innerHTML = 'Score: ' + score;
      accuracy.push(100);
      accVal = 0;
      for (var i = 0; i < accuracy.length; i++) {
        accVal += accuracy[i];
      }
      accVal /= accuracy.length;
      accVal = Math.round(accVal * 100) / 100;
      // The line above gives the accVal variable a limit of two decimals.
      accField.innerHTML = 'Accuracy: ' + accVal + '%';
      target.style.left = random(250) + 'px';
      target.style.top = random(250) + 'px';
    }
  </script>
  <style>
    main {
      width: 280px;
      height: 280px;
      border: 1px solid black;
      margin: 0 auto;
    }
    section {
      text-align: center;
    }
    #target {
      background-color: black;
      position: relative;
      width: 30px;
      height: 30px;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
  </style>
</head>
<body style="font-family: Arial;">
  <header>
    <nav>
      <ul>
        <li><a href="./index.html">Back to ./index.html</a></li>
        <li><a href="./images-and-frames.html">Images and IFrames section</a></li>
        <li><a href="./lists-and-tables.html">Lists and Tables section</a></li>
        <li><a href="./forms.html">Apply for a j*b</a></li>
        <li><a href="./was.html">Here (./was.html)</a></li>
      </ul>
    </nav>
    <h1>Whack-A-Square</h1>
    <h2>Not traditional whack-a-mole</h2>
  </header>
  <hr />
  <section>
    <label id="score" hidden>Score: 0</label><br />
    <label id="time" hidden>Time left: 30 seconds</label><br />
    <label id="accuracy" hidden>Accuracy: --%</label><br />
    <label id="rate" hidden>Rate: -- hits per minute (-- per second)</label><br />
  <button id="start" onclick="start();">Start game</button>
  </section>
  <main onmouseup="miss();">
    <button id="target" onmouseup="hit();">â– </button>
  </main>
  <footer>
    <hr />
    <a href="./index.html">Back to ./index.html</a>
  </footer>
</body>
</html>